CREATE TABLE [Jobs]
(
    [JobID] INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT
    ,[UpdateDateTime] DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP

    ,[ScheduleID] INTEGER NOT NULL

    ,[InsertDateUTC] DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
    ,[QueueDateUTC] DATETIME NOT NULL
    ,[CompleteDateUTC] DATETIME NULL

    ,[StatusCode] TEXT NOT NULL DEFAULT 'NEW'

    ,[DetailedMessage] TEXT NULL

    -- If this job errors, this is the ID to acknowledge the error
    -- If the job doesn't error, this is ignored
    ,[AcknowledgementID] TEXT
    ,[AcknowledgementDate] DATETIME NULL

    ,FOREIGN KEY ([ScheduleID]) REFERENCES [Schedules] ([ScheduleID])
    ,CHECK (
        [StatusCode] = 'NEW' OR [StatusCode] = 'CAN' OR [StatusCode] = 'ERR'
        OR [StatusCode] = 'RUN' OR [StatusCode] = 'ACK' OR [StatusCode] = 'SUC'
    )
);

CREATE INDEX [IX_Jobs_Status] ON [Jobs] ([StatusCode]);
CREATE INDEX [IX_Jobs_ScheduleID] ON [Jobs] ([ScheduleID]);
CREATE INDEX [IX_Jobs_AcknowledgementID] ON [Jobs] ([AcknowledgementID]);
